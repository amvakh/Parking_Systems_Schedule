digraph PKS_DFD_Level1 {
	graph [nodesep=0.8 ranksep=0.8]
	rankdir=TB
	size="14,14"
	dpi=600
	User [label=User shape=box]
	Cloudflare [label="Cloudflare Gateway" shape=box]
	Stripe [label="Stripe API" shape=box]
	LPR [label="LPR Camera" shape=box]
	Admin [label=Admin shape=box]
	P1 [label="/zones" shape=ellipse]
	P2 [label="Validate Zone ID" shape=ellipse]
	P3 [label="Login Page" shape=ellipse]
	P3a [label="Validate Credentials" shape=ellipse]
	P3b [label="Forgot Password Handler" shape=ellipse]
	P4a [label="Guest Plate Entry" shape=ellipse]
	P4b [label="Create Account + Plate Entry" shape=ellipse]
	P4c [label="Review Stored Plate" shape=ellipse]
	P5 [label="Payment Portal" shape=ellipse]
	P6 [label="Plate Authorization (PA)" shape=ellipse]
	P7 [label="Admin Management" shape=ellipse]
	D1 [label="Zones DB" shape=cylinder]
	D2 [label="Payment Records DB" shape=cylinder]
	D3 [label="Session DB" shape=cylinder]
	D4 [label="License Plate DB" shape=cylinder]
	D5 [label="User DB" shape=cylinder]
	User -> Cloudflare [label="QR/SMS Access"]
	Cloudflare -> P1 [label="If US IP → /zones"]
	P1 -> P2 [label="Enter Zone ID"]
	P2 -> D1 [label="Lookup Zone"]
	P2 -> P3 [label="If Valid → Login"]
	P2 -> P1 [label="If Invalid → Loop Back"]
	P3 -> P3a [label="Enter Email & Password"]
	P3a -> P3 [label="If Password Invalid → Retry"]
	P3a -> P4c [label="If Login Success → Confirm Plate"]
	P3 -> P3b [label="Forgot Password"]
	P3b -> P4c [label="Password Reset → Confirm Plate"]
	P3 -> P4a [label="Checkout as Guest"]
	P3 -> P4b [label="Create Account"]
	P4a -> D4 [label="Save Plate"]
	P4b -> D4 [label="Save Plate + User"]
	P4c -> D4 [label="Validate Stored Plate"]
	P4a -> P5
	P4b -> P5
	P4c -> P5
	P5 -> Stripe [label="Send Payment"]
	Stripe -> P5 [label=Confirmation]
	P5 -> D2 [label="Record Payment"]
	P5 -> D3 [label="Create Session"]
	P5 -> D4 [label="Link Plate to Payment"]
	LPR -> P6 [label="Captured Plate"]
	P6 -> D3 [label="Session Lookup"]
	P6 -> D4 [label="Plate Match"]
	P6 -> User [label="Valid / Invalid Status"]
	Admin -> P7
	P7 -> D1 [label="Manage Zones"]
	P7 -> D2 [label="Override Payments"]
	P7 -> D4 [label="Manage Plates"]
	P7 -> D5 [label="Manage Users"]
}
